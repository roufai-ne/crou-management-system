# ğŸ¤– GUIDE DE COORDINATION POUR AGENTS AI
## ImplÃ©mentation Module Gestion de Restauration CROU

---

## ğŸ“‹ CONTEXTE EXÃ‰CUTIF

**Projet** : IntÃ©gration module Gestion de Restauration dans plateforme CROU MESRIT (Niger)
**Client** : Roufai (MESRIT - Ministry of Higher Education, Research and Technological Innovation)
**Technologie Stack** : Ã€ confirmer (Next.js/React, Node.js/Python Backend, PostgreSQL)
**Budget Temps** : ~6-8 semaines (phases itÃ©ratives)
**PrioritÃ©** : Haute - Impact direct sur gestion acadÃ©mique

---

## ğŸ¯ OBJECTIF PRINCIPAL

CrÃ©er un systÃ¨me modulaire et intÃ©grÃ© permettant de :
1. âœ… GÃ©rer les menus variÃ©s du CROU avec composition produits
2. âœ… Ã‰mettre & tracker les tickets de restauration par catÃ©gories
3. âœ… Enregistrer les besoins quotidiens avec dÃ©duction du stock (validation manuelle)
4. âœ… Tracker les pertes/gaspillage
5. âœ… GÃ©nÃ©rer des rapports journaliers/mensuels/annuels
6. âœ… Exporter en PDF et Excel
7. âœ… Synchroniser avec module Stock existant (API)
8. âœ… IntÃ©grer donnÃ©es financiÃ¨res (module ComptabilitÃ© existant)

---

## ğŸ“Š VUE D'ENSEMBLE ARCHITECTURE

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   FRONTEND (Next.js/React)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Pages: Menus, Tickets,    â”‚
â”‚ â€¢ Besoins, Pertes, Rapports â”‚
â”‚ â€¢ Dashboards                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                â”‚
       â–¼                â–¼
    [API REST]    [WebSockets pour
    Restauration  notifications]
       â”‚                â”‚
       â–¼                â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   BACKEND (Express/FastAPI/etc)  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Controllers:                     â”‚
â”‚ â€¢ MenuController                 â”‚
â”‚ â€¢ TicketController               â”‚
â”‚ â€¢ BesoinsController              â”‚
â”‚ â€¢ PertesController               â”‚
â”‚ â€¢ RapportsController             â”‚
â”‚ â€¢ IntÃ©grationController (Stock)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
       â”Œâ”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”
       â”‚       â”‚       â”‚
       â–¼       â–¼       â–¼
    [BD Local] [API Stock] [API Finances]
       â”‚           â”‚           â”‚
   Postgres    Existante   Existante
```

---

## ğŸ§© MODULES Ã€ IMPLÃ‰MENTER (Ordre RecommandÃ©)

### MODULE 1 : Base de DonnÃ©es & ORM
**ResponsabilitÃ©** : CrÃ©er le schÃ©ma BD + migrations

**Livrables** :
- [ ] 6 tables : Menus, DÃ©tails_Menus, CatÃ©gories_Tickets, Tickets, Besoins, DÃ©tails_Besoins, Consommation, Pertes
- [ ] Migrations (`2025-04-24-001-create-menus.sql` etc)
- [ ] ModÃ¨les ORM (Django/SQLAlchemy/Sequelize)
- [ ] Index sur clÃ©s Ã©trangÃ¨res + dates (perfs)
- [ ] Soft-delete pour audit trail

**Fichiers Ã  crÃ©er** :
```
src/models/
â”œâ”€â”€ Menu.js
â”œâ”€â”€ CategorieTicket.js
â”œâ”€â”€ Ticket.js
â”œâ”€â”€ Besoin.js
â”œâ”€â”€ DetailBesoin.js
â”œâ”€â”€ Consommation.js
â”œâ”€â”€ Perte.js
â””â”€â”€ index.js (exports)

src/migrations/
â”œâ”€â”€ 2025-04-24-001-init-restauration.js
â”œâ”€â”€ 2025-04-24-002-add-pertes.js
â””â”€â”€ 2025-04-24-003-add-consommation.js
```

**Acceptance Criteria** :
- âœ… Toutes tables crÃ©Ã©es et testÃ©es
- âœ… Relations FK valides
- âœ… Seed data : Tarifs CROU (150/350/350 FCFA)

---

### MODULE 2 : API CRUD - Menus
**ResponsabilitÃ©** : CRUD complet pour menus

**Livrables** :
- [ ] Endpoints : GET (list + detail), POST (create), PUT (edit), DELETE (inactiver)
- [ ] Validation : nom_menu obligatoire, type_service ENUM, date_application valide
- [ ] Filtrage : date_from/to, type_service, statut
- [ ] DÃ©tails menus : Gestion tableau produits dynamique

**Endpoints Ã  crÃ©er** :
```javascript
GET    /api/restauration/menus                    // Liste avec filtres
POST   /api/restauration/menus                    // CrÃ©er menu
GET    /api/restauration/menus/:menu_id           // DÃ©tail
PUT    /api/restauration/menus/:menu_id           // Ã‰diter
DELETE /api/restauration/menus/:menu_id           // Inactiver
GET    /api/restauration/menus/:menu_id/details   // Produits du menu
POST   /api/restauration/menus/:menu_id/details   // Ajouter produit
DELETE /api/restauration/menus/:menu_id/details/:detail_id // Enlever produit
```

**Tests** :
```javascript
describe('MenuAPI', () => {
  test('CREATE menu avec composition');
  test('GET menu calcule coÃ»t total');
  test('EDIT menu met Ã  jour dÃ©tails');
  test('FILTER par date + type_service');
  test('DELETE inactif menu');
});
```

**Acceptance Criteria** :
- âœ… CRUD 100% fonctionnel
- âœ… Validation stricte
- âœ… Retours d'erreur explicites

---

### MODULE 3 : API CRUD - Tickets & CatÃ©gories
**ResponsabilitÃ©** : Gestion tickets (Ã©mission + catÃ©gories)

**Livrables** :
- [ ] CatÃ©gories CRUD
- [ ] Ticket CRUD
- [ ] Ã‰mission batch de tickets
- [ ] Validation statuts (Non_ValidÃ© â†’ ValidÃ© â†’ EncaissÃ©)

**Endpoints** :
```javascript
// CatÃ©gories
GET    /api/restauration/categories-tickets
POST   /api/restauration/categories-tickets
PUT    /api/restauration/categories-tickets/:id
DELETE /api/restauration/categories-tickets/:id

// Tickets
GET    /api/restauration/tickets?date_from=&date_to=&statut=
POST   /api/restauration/tickets                  // Ã‰mettre 1+ tickets
GET    /api/restauration/tickets/:ticket_id
PATCH  /api/restauration/tickets/:ticket_id/valider
PATCH  /api/restauration/tickets/:ticket_id/encaisser
```

**RÃ¨gles mÃ©tier** :
- Ticket.montant_total = quantitÃ© Ã— prix_unitaire (calculÃ©, pas saisi)
- Type_service doit matcher avec catÃ©gorie_ticket
- GratuitÃ©s = catÃ©gorie spÃ©ciale avec prix = 0
- Validation = dÃ©bloquer pour encaissement

**Tests** :
```javascript
describe('TicketAPI', () => {
  test('Ã‰mettre 50 tickets rÃ©guliers');
  test('Tarifs varient par type_service');
  test('GratuitÃ©s montant = 0');
  test('Status flow: Non_ValidÃ© â†’ ValidÃ© â†’ EncaissÃ©');
});
```

---

### MODULE 4 : API CRUD - Besoins Quotidiens
**ResponsabilitÃ©** : Gestion besoins journaliers + calcul automatique

**Livrables** :
- [ ] CrÃ©ation fiche besoins (sÃ©lection date, type_service, menu)
- [ ] Calcul automatique produits requis
- [ ] Affichage stock disponible
- [ ] Bouton "Valider & DÃ©duire du Stock"

**Endpoints** :
```javascript
GET    /api/restauration/besoins?date=&type_service=
POST   /api/restauration/besoins                  // CrÃ©er fiche
GET    /api/restauration/besoins/:besoin_id
PUT    /api/restauration/besoins/:besoin_id      // Ã‰diter (avant validation)
POST   /api/restauration/besoins/:besoin_id/deduire-stock  // â­ CLÃ‰E
PATCH  /api/restauration/besoins/:besoin_id/valider
```

**Logique critique** :
```javascript
// POST /api/restauration/besoins
1. CrÃ©er record Besoin (statut = Brouillon)
2. RÃ©cupÃ©rer menu_id
3. Fetch dÃ©tails menu â†’ liste produits + quantitÃ©_unitaire
4. Calculer : quantite_totale = nombre_rationnaires Ã— quantitÃ©_unitaire
5. Pour chaque produit :
   a. GET /api/stock/produits/{id}/disponibilite
   b. CrÃ©er DetailBesoin avec stock_disponible
   c. Calculer suffisance : stock_disponible >= quantite_totale
6. Retourner tableau dÃ©tails avec statuts

// POST /api/restauration/besoins/:besoin_id/deduire-stock
1. RÃ©cupÃ©rer tous les DetailBesoins
2. VÃ©rifier tous les produits ont statut OK (sinon rejeter)
3. Construire payload pour API Stock :
   {
     "type_mouvement": "Consommation_Restauration",
     "reference_restauration": besoin_id,
     "date": date_besoin,
     "mouvements": [
       { produit_id, quantite, motif: "Besoins quotidiens" }, ...
     ]
   }
4. Appel POST /api/stock/mouvements
5. Si OK :
   - Mettre Ã  jour Besoin.statut = Stock_DÃ©duit
   - Loger succÃ¨s
   - Retourner confirmation
6. Si ERREUR :
   - Mettre Ã  jour Besoin.statut = Erreur_DÃ©duction
   - Retourner dÃ©tail erreur (produit, stock_insuffisant, etc)
7. Pas de rollback partiel (tout ou rien)
```

**Tests** :
```javascript
describe('BesoinsAPI', () => {
  test('CrÃ©ation calcule automatiquement produits requis');
  test('Stock insuffisant affiche âš ï¸');
  test('Bouton dÃ©duction appelle API Stock correctement');
  test('SuccÃ¨s : Statut passe Ã  Stock_DÃ©duit');
  test('Erreur : Permet corriger menu ou qty');
});
```

---

### MODULE 5 : API CRUD - Consommation
**ResponsabilitÃ©** : Tracker consommation rÃ©elle post-service

**Livrables** :
- [ ] Fiche de consommation (aprÃ¨s service)
- [ ] Nombre rationnaires effectivement servis
- [ ] DÃ©tection anomalies

**Endpoints** :
```javascript
POST   /api/restauration/consommation
GET    /api/restauration/consommation?date=&type_service=
PATCH  /api/restauration/consommation/:id
```

**Champs** :
- besoin_id (FK)
- nombre_rationnaires_servis (INT)
- statut (Servi, Non_Servi, Partiellement_Servi)
- notes (anomalies)

---

### MODULE 6 : API CRUD - Pertes/Gaspillage
**ResponsabilitÃ©** : Enregistrer & synchroniser pertes vers Stock

**Livrables** :
- [ ] Interface saisie pertes
- [ ] Calcul valeur FCFA automatique
- [ ] API appel Stock pour mouvement
- [ ] Statistiques gaspillage

**Endpoints** :
```javascript
POST   /api/restauration/pertes                  // Enregistrer perte
GET    /api/restauration/pertes?date_from=&motif=
GET    /api/restauration/pertes/statistiques?mois=
DELETE /api/restauration/pertes/:id              // Soft-delete
```

**Logique critique** :
```javascript
// POST /api/restauration/pertes
1. Valider produit_id, quantite_perdue, motif
2. GET /api/stock/produits/{id} â†’ prix_unitaire
3. Calculer value_fcfa = quantite_perdue Ã— prix_unitaire
4. CrÃ©er record Perte
5. POST /api/stock/mouvements
   {
     "type_mouvement": "Perte_Gaspillage",
     "produit_id": id,
     "quantite": quantite_perdue,
     "motif": motif,
     "date_peremption": date_peremption (si applicable),
     "value_fcfa": value_fcfa,
     "reference_restauration": perte_id
   }
6. Log succÃ¨s/erreur
7. Retourner perte crÃ©Ã©e
```

**Statistiques** :
```javascript
// GET /api/restauration/pertes/statistiques?mois=2025-04
1. Fetch toutes pertes du mois
2. Calculer :
   - Total pertes FCFA
   - Taux gaspillage = (Î£ pertes value) / (Î£ stock consommÃ© value) Ã— 100
   - Produit le plus gaspillÃ©
   - Distribution par motif
3. Retourner objets stats
```

---

### MODULE 7 : API Rapports & Exports
**ResponsabilitÃ©** : AgrÃ©gation donnÃ©es + gÃ©nÃ©ration rapports PDF/Excel

**Livrables** :
- [ ] Rapports journalier/mensuel/annuel
- [ ] Graphiques (Recharts/Chart.js)
- [ ] Export PDF (jsPDF)
- [ ] Export Excel (SheetJS)

**Endpoints** :
```javascript
GET    /api/restauration/rapports/journalier?date=YYYY-MM-DD
GET    /api/restauration/rapports/mensuel?mois=YYYY-MM
GET    /api/restauration/rapports/annuel?annee=YYYY
POST   /api/restauration/rapports/export-pdf     // GÃ©nÃ¨re background
POST   /api/restauration/rapports/export-excel
GET    /api/restauration/rapports/export-status/:task_id  // Check status
```

**Rapport Journalier (JSON)** :
```javascript
{
  "date": "2025-04-24",
  "crou": "CROU Niamey",
  "services": {
    "petit_dejeuner": {
      "menu": "ThÃ© + Pain",
      "tickets_payants": 100,
      "tickets_gratuits": 20,
      "total_consommateurs": 120,
      "recettes_fcfa": 18000,
      "pertes": []
    },
    "dejeuner": { ... },
    "diner": { ... }
  },
  "totaux": {
    "total_consommateurs": 550,
    "recettes_total": 192500,
    "pertes_total_fcfa": 1200
  }
}
```

**Rapport Mensuel** :
```javascript
{
  "mois": "2025-04",
  "synthese_semaines": [
    {
      "semaine": 1,
      "total_consommateurs": 0,
      "recettes": 0
    },
    ...
  ],
  "moyennes": {
    "consommateurs_par_jour": 43.3,
    "recettes_par_jour": 13366
  },
  "evolution_vs_mois_precedent": "+15%"
}
```

**Export PDF** :
- Utiliser jsPDF + html2canvas
- Branding MESRIT/CROU
- Tableaux + Graphiques
- 1-2 pages max

**Export Excel** :
- SheetJS (xlsx)
- Feuilles : DonnÃ©es brutes, Graphiques, SynthÃ¨se
- Formules pour calculs additionnels
- Mise en forme professionnelle

---

### MODULE 8 : Frontend - Interfaces Utilisateur
**ResponsabilitÃ©** : Pages React / Next.js pour chaque fonctionnalitÃ©

**Pages Ã  crÃ©er** :
```
src/pages/restauration/
â”œâ”€â”€ dashboard.js          // Tableau de bord main
â”œâ”€â”€ menus/
â”‚  â”œâ”€â”€ index.js          // Liste menus
â”‚  â”œâ”€â”€ [id].js           // DÃ©tail menu
â”‚  â””â”€â”€ nouveau.js        // CrÃ©er menu
â”œâ”€â”€ tickets/
â”‚  â”œâ”€â”€ index.js          // Historique tickets
â”‚  â””â”€â”€ emettre.js        // Ã‰mettre tickets
â”œâ”€â”€ besoins/
â”‚  â”œâ”€â”€ index.js          // Historique besoins
â”‚  â””â”€â”€ nouveau.js        // CrÃ©er fiche besoin
â”œâ”€â”€ pertes/
â”‚  â”œâ”€â”€ index.js          // Historique pertes
â”‚  â””â”€â”€ nouveau.js        // Enregistrer perte
â”œâ”€â”€ rapports/
â”‚  â”œâ”€â”€ index.js          // Page rapports
â”‚  â””â”€â”€ [type].js         // Rapport dÃ©tail
â””â”€â”€ parametres.js        // Config tarifs
```

**Composants partagÃ©s** :
```
src/components/restauration/
â”œâ”€â”€ MenuForm.jsx         // Formulaire + tableau produits
â”œâ”€â”€ TicketEmission.jsx   // Interface Ã©mission
â”œâ”€â”€ BesoinsForm.jsx      // Fiche besoins
â”œâ”€â”€ PertesForm.jsx       // Formulaire pertes
â”œâ”€â”€ RapportTable.jsx     // Affichage rapports
â”œâ”€â”€ RapportCharts.jsx    // Graphiques
â”œâ”€â”€ StockStatus.jsx      // Affichage stock dispo
â””â”€â”€ ConfirmationModals.jsx // Modales validation
```

**DÃ©tail interface clÃ©e : BesoinsForm**
```jsx
const BesoinsForm = () => {
  const [date, setDate] = useState();
  const [typeService, setTypeService] = useState('DÃ©jeuner');
  const [menuId, setMenuId] = useState();
  const [rationnaires, setRationnaires] = useState(2000);
  const [besoins, setBesoins] = useState([]);  // Tableau produits
  const [loading, setLoading] = useState(false);

  // Loader : quand menu change, calculer besoins
  useEffect(() => {
    if (!menuId) return;
    (async () => {
      const dÃ©tailsMenu = await API.get(`/menus/${menuId}/details`);
      const besoinsCalculÃ©s = dÃ©tailsMenu.map(detail => ({
        produit_id: detail.produit_id,
        produit_nom: detail.produit.nom,
        ration_unitaire: detail.ration_unitaire,
        quantite_totale: rationnaires * detail.ration_unitaire,
        stock_disponible: await API.get(`/stock/${detail.produit_id}/dispo`),
        suffisant: stock >= (rationnaires * detail.ration_unitaire)
      }));
      setBesoins(besoinsCalculÃ©s);
    })();
  }, [menuId, rationnaires]);

  // Bouton dÃ©duction
  const handleDeduireStock = async () => {
    // Popup confirmation
    if (!confirm("Confirmer dÃ©duction du stock ?")) return;

    try {
      const response = await API.post(
        `/besoins/${besoins.id}/deduire-stock`
      );
      if (response.success) {
        showSuccess("âœ“ Stock dÃ©duit avec succÃ¨s !");
        // Refresh besoins Ã©tat
      } else {
        showError(response.erreur);  // Ex: "Riz insuffisant (30 vs 50)"
      }
    } catch (error) {
      showError("Erreur dÃ©duction: " + error.message);
    }
  };

  return (
    <form>
      <DatePicker value={date} onChange={setDate} />
      <Select value={typeService} onChange={setTypeService}>
        <option>Petit dÃ©jeuner</option>
        <option>DÃ©jeuner</option>
        <option>DÃ®ner</option>
      </Select>
      <MenuSelector value={menuId} onChange={setMenuId} type={typeService} />
      <Input value={rationnaires} onChange={setRationnaires} label="Rationnaires" />

      <Table>
        <TableHeader>
          <th>Produit</th>
          <th>Ration/unit</th>
          <th>QuantitÃ© totale</th>
          <th>Stock dispo</th>
          <th>Statut</th>
        </TableHeader>
        <TableBody>
          {besoins.map(b => (
            <tr key={b.produit_id}>
              <td>{b.produit_nom}</td>
              <td>{b.ration_unitaire}</td>
              <td>{b.quantite_totale}</td>
              <td>{b.stock_disponible}</td>
              <td>
                {b.suffisant ? (
                  <span className="badge-ok">âœ“ OK</span>
                ) : (
                  <span className="badge-alert">âš ï¸ Insuffisant</span>
                )}
              </td>
            </tr>
          ))}
        </TableBody>
      </Table>

      <Button 
        onClick={handleDeduireStock} 
        className="btn-primary-lg"
        style={{ backgroundColor: '#dc3545' }}
      >
        ğŸ”´ Valider & DÃ©duire du Stock
      </Button>
    </form>
  );
};
```

---

### MODULE 9 : IntÃ©gration API Stock
**ResponsabilitÃ©** : Wrapper + tester appels vers API Stock existante

**Fichiers** :
```
src/services/
â”œâ”€â”€ stockAPI.js          // Wrapper pour appels Stock
â””â”€â”€ restaurationAPI.js   // Appels Restauration
```

**StockAPI (exemple)** :
```javascript
// src/services/stockAPI.js
export const stockAPI = {
  // RÃ©cupÃ©rer produits alimentaires
  async getProduits(type = 'Alimentaire') {
    return fetch('/api/stock/produits?type=' + type)
      .then(r => r.json())
      .catch(e => {
        logger.error('StockAPI.getProduits failed:', e);
        throw new Error('Impossible rÃ©cupÃ©rer produits');
      });
  },

  // VÃ©rifier disponibilitÃ© 1 produit
  async getDisponibilite(produit_id) {
    return fetch(`/api/stock/produits/${produit_id}/disponibilite`)
      .then(r => r.json())
      .catch(e => {
        logger.error(`StockAPI.getDisponibilite(${produit_id}) failed:`, e);
        throw new Error('Impossible vÃ©rifier stock');
      });
  },

  // â­ CrÃ©er mouvement de dÃ©duction
  async createMouvement(payload) {
    // payload = {
    //   type_mouvement: "Consommation_Restauration",
    //   reference_restauration: besoin_id,
    //   date: YYYY-MM-DD,
    //   mouvements: [{produit_id, quantite, motif}, ...]
    // }

    const response = await fetch('/api/stock/mouvements', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });

    const data = await response.json();

    if (!response.ok) {
      // Erreur dÃ©taillÃ©e du Stock
      logger.error('StockAPI.createMouvement failed:', data);
      throw new Error(data.erreur || 'Erreur crÃ©er mouvement stock');
    }

    return data;
  }
};
```

---

### MODULE 10 : Dashboard & Notifications
**ResponsabilitÃ©** : Widget restauration + alertes temps rÃ©el

**Dashboard Widget** :
```jsx
<DashboardWidget title="Restauration">
  <Metric label="FrÃ©quentation aujourd'hui" value={550} />
  <Metric label="Recettes" value="192,500 FCFA" />
  <Metric label="Pertes" value="1,200 FCFA" />
  <StatusIndicator 
    label="Ã‰tat stock"
    value={numberOfAlerts > 0 ? "Alertes" : "Normal"}
    color={numberOfAlerts > 0 ? "red" : "green"}
  />
</DashboardWidget>
```

**Notifications** :
- WebSocket pour ruptures stock (temps rÃ©el)
- Toast pour confirmations actions
- Email digest (optionnel)

---

## ğŸ§ª STRATÃ‰GIE DE TEST

### Tests Unitaires
```
coverage: 80%+ pour logique critique

Des tests pour:
â”œâ”€ Calculs (besoins, recettes, gaspillage)
â”œâ”€ Validations (montants positifs, dates valides)
â”œâ”€ Transitions statuts (Brouillon â†’ ValidÃ© â†’ Stock_DÃ©duit)
â””â”€ Appels API (mocks Stock)
```

### Tests IntÃ©gration
```
des tests pour:
â”œâ”€ Workflow complet menu â†’ besoin â†’ dÃ©duction
â”œâ”€ Erreur dÃ©duction â†’ rollback
â”œâ”€ Pertes â†’ sync Stock
â”œâ”€ Export PDF/Excel â†’ fichier gÃ©nÃ©rÃ©
â””â”€ Rapports â†’ donnÃ©es correctes
```

### Tests Manuels (UAT)
```
Liste UAT Ã  faire avec Roufai:
â”œâ”€ Ã‰mission 50 tickets + vÃ©rif total recettes
â”œâ”€ CrÃ©er besoin, stock insuffisant, essayer dÃ©duction â†’ âœ“ Erreur OK
â”œâ”€ Corriger menu, rÃ©essayer dÃ©duction â†’ âœ“ SuccÃ¨s
â”œâ”€ Enregistrer perte, vÃ©rifier sync vers stock
â”œâ”€ GÃ©nÃ©rer rapport PDF, vÃ©rifier format
â””â”€ Dashboard mise Ã  jour temps rÃ©el
```

---

## ğŸ“… TIMELINE RECOMMANDÃ‰E

| Phase | DurÃ©e | Modules | Status |
|-------|-------|---------|--------|
| **1: Setup & BD** | 1 sem | 1-2 | â³ En cours |
| **2: API Core** | 1.5 sem | 3-5 | â³ Ã€ faire |
| **3: Stock Integration** | 1 sem | Modules 4+6 liaison | â³ Ã€ faire |
| **4: Frontend** | 1.5 sem | 8 | â³ Ã€ faire |
| **5: Rapports** | 1 sem | 7 | â³ Ã€ faire |
| **6: Polish & Tests** | 0.5 sem | All | â³ Ã€ faire |
| **7: UAT & Deploy** | 0.5 sem | All | â³ Ã€ faire |

**Total: ~6.5 semaines**

---

## ğŸš¨ RISQUES & MITIGATION

| Risque | ProbabilitÃ© | Impact | Mitigation |
|--------|-------------|--------|-----------|
| API Stock indisponible pendant dev | Moyen | Ã‰levÃ© | Mocker API tÃ´t, tests indÃ©pendants |
| Volumes importants (1000s tickets/jour) | Bas | Ã‰levÃ© | Index BD, pagination, caching |
| Changement tarifs en cours de journÃ©e | Bas | Moyen | Gel tarif Ã  00:00, historique |
| DonnÃ©es sync cassÃ©es | Bas | Critique | Logs dÃ©taillÃ©s + endpoint reconciliation |
| Oubli intÃ©gration Finances | Moyen | Moyen | Planifier tÃ´t dans MODULE 7 |
| Performance exports Excel gros volumes | Bas | Moyen | GÃ©nÃ©rer en background (Bull) |

---

## ğŸ DELIVERABLES FINAUX

```
â”œâ”€ Code source (GitHub/GitLab)
â”‚  â”œâ”€ Backend (API + tests)
â”‚  â””â”€ Frontend (Pages + composants)
â”œâ”€ Documentation
â”‚  â”œâ”€ README installation
â”‚  â”œâ”€ API docs (Swagger/OpenAPI)
â”‚  â”œâ”€ Diagrammes architecture
â”‚  â””â”€ ProcÃ©dures opÃ©rationnelles
â”œâ”€ Database
â”‚  â”œâ”€ Migrations
â”‚  â”œâ”€ Seed data (tarifs, catÃ©gories)
â”‚  â””â”€ Backup init
â”œâ”€ Tests
â”‚  â”œâ”€ Unit tests (80%+ coverage)
â”‚  â”œâ”€ Integration tests
â”‚  â””â”€ UAT checklist
â””â”€ Deployment
   â”œâ”€ Docker compose (dev + prod)
   â”œâ”€ CI/CD pipeline
   â””â”€ Runbooks (troubleshooting)
```

---

## ğŸ“ POINTS DE CONTACT

**PropriÃ©taire Projet** : Roufai
- Clarifications mÃ©tier
- DÃ©cisions architecture
- Feedback UAT

**Tech Lead (Si existant)** :
- Code review
- Standards projet

**Admin Infrastructure** :
- AccÃ¨s API Stock
- Deployment prod

---

## âœ… CHECKLIST PRE-LANCEMENT

- [ ] AccÃ¨s BD dev configurÃ©
- [ ] API Stock documentÃ©e + testÃ©e
- [ ] Team dev familiarisÃ©e avec projet
- [ ] Stack technologique confirmÃ©e
- [ ] Tarifs CROU 2025 confirmÃ©s (150/350/350 ?)
- [ ] Design UI approuvÃ©
- [ ] Plan de migration donnÃ©es (si upgrading)
- [ ] Alertes/notifications configurÃ©es
- [ ] Monitoring BD setup (logs, perfs)
- [ ] Plan backup & disaster recovery

---

## ğŸš€ LET'S BUILD IT !

**Contact Roufai** : DÃ©marrage immÃ©diat si tous les prÃ©-requis OK

**Prochaine Ã©tape** : 
1. Confirmer stack tech
2. CrÃ©er repo GitHub
3. Setup BD dev
4. DÃ©buter MODULE 1 (Migrations)

---

*Document gÃ©nÃ©rÃ© le : 2025-04-24*
*Version : 1.0*
*Auteur : AI Coordination Assistant*