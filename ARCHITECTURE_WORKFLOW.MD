# ğŸ—ï¸ ARCHITECTURE & WORKFLOWS - IntÃ©gration Restauration CROU

## ğŸ“ Diagramme Architectural Global

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                          PLATEFORME CROU - Niger                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   MODULE RESTAURATION    â”‚       â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚      (NOUVEAU)           â”‚â—„â”€â”€â”€â”€â”€â–ºâ”‚   MODULE STOCK             â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤       â”‚   (EXISTANT)               â”‚
â”‚ â€¢ Menus & Recettes       â”‚       â”‚ â€¢ Produits                 â”‚
â”‚ â€¢ Tickets & CatÃ©gories   â”‚       â”‚ â€¢ QuantitÃ©s                â”‚
â”‚ â€¢ Besoins Quotidiens     â”‚       â”‚ â€¢ Mouvements               â”‚
â”‚ â€¢ Pertes/Gaspillage      â”‚       â”‚ â€¢ Seuils d'alerte          â”‚
â”‚ â€¢ Dashboard Restaurant   â”‚       â”‚ â€¢ Commandes fournisseurs   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚                                      â–²
         â”‚                                      â”‚
         â”‚          API REST                    â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                      â”‚
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â–¼            â–¼            â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ FINANCESâ”‚ â”‚COMPTABI- â”‚ â”‚  CALENDRIER  â”‚
    â”‚RECETTES â”‚ â”‚LITÃ‰      â”‚ â”‚  ACADÃ‰MIQUE  â”‚
    â”‚(EXISTANT)â”‚ â”‚(EXISTANT)â”‚ â”‚ (RÃ‰FÃ‰RENCE)  â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              BASE DE DONNÃ‰ES RESTAURATION                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â€¢ Menus (composition produits)                               â”‚
â”‚ â€¢ Tickets (catÃ©gories, Ã©missions)                            â”‚
â”‚ â€¢ Besoins Quotidiens (fiche journaliÃ¨re)                     â”‚
â”‚ â€¢ Consommation (suivi post-service)                          â”‚
â”‚ â€¢ Pertes/Gaspillage (historique mouvements)                  â”‚
â”‚ â€¢ Rapports (agrÃ©gations, exports)                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ”„ WORKFLOW 1 : Gestion d'un Service Restauration (JournÃ©e type)

```
MATIN (J-1 soir ou J matin)
â”œâ”€ [GESTIONNAIRE RESTO] CrÃ©e/SÃ©lectionne menu du jour
â”‚  â””â”€ SystÃ¨me calcule besoins = nombre_rationnaires Ã— rations_menu
â”‚
â”œâ”€ [SYSTÃˆME] Affiche tableau besoins avec stock disponible
â”‚  â””â”€ Statut : âœ“ OK ou âš ï¸ INSUFFISANT pour chaque produit
â”‚
â”œâ”€ [RESPONSABLE RESTO] Valide & clique "Valider & DÃ©duire du Stock"
â”‚  â”‚  â””â”€ Pop-up confirmation : "Confirmer dÃ©duction de X produits ?"
â”‚  â”‚
â”‚  â””â”€ [API CALL] POST /api/stock/mouvements
â”‚     â”œâ”€ Type: "Consommation_Restauration"
â”‚     â”œâ”€ Produits: [{id, qtÃ©, besoin_id}, ...]
â”‚     â”œâ”€ RÃ©ponse: âœ“ OK ou âœ— ERREUR (ex: stock Ã©puisÃ© depuis)
â”‚     â””â”€ Statut besoin passe Ã  : "Stock_DÃ©duit"

MIDI/SOIR (Pendant le service)
â”œâ”€ [AGENT TICKETING] Ã‰met tickets via interface
â”‚  â”œâ”€ SÃ©lectionne catÃ©gorie (rÃ©gulier, gratuit, etc.)
â”‚  â”œâ”€ Saisit quantitÃ©
â”‚  â””â”€ SystÃ¨me enregistre avec montant
â”‚
â””â”€ [SERVICE DE RESTAURATION] PrÃ©pare & sert selon menu

APRÃˆS SERVICE (J soir)
â”œâ”€ [AGENT RESTO] Enregistre consommation rÃ©elle
â”‚  â”œâ”€ Nombre rationnaires effectivement servis
â”‚  â”œâ”€ Anomalies (ex: menu demi-portion)
â”‚  â””â”€ Statut besoin passe Ã  : "ConsommÃ©"
â”‚
â””â”€ [GÃ‰RANT] Saisit pertes constatÃ©es (si nÃ©cessaire)
   â”œâ”€ Produit, quantitÃ©, motif (pÃ©rimÃ©/gaspillage)
   â”œâ”€ [API CALL] POST /api/stock/mouvements (Perte)
   â””â”€ Valeur FCFA calculÃ©e & tracÃ©e

RAPPORT (J+1 matin)
â”œâ”€ Dashboard affiche :
â”‚  â”œâ”€ FrÃ©quentation hier
â”‚  â”œâ”€ Recettes hier
â”‚  â”œâ”€ Pertes constatÃ©es
â”‚  â””â”€ Ã‰tat stock aprÃ¨s dÃ©ductions
â”‚
â””â”€ Export rapport journalier disponible (PDF/Excel)
```

---

## ğŸ”„ WORKFLOW 2 : DÃ©duction du Stock (DÃ©tail technique)

```
[INTERFACE RESTAURATION]
        â”‚
        â”‚  Besoin Quotidien crÃ©Ã©/validÃ©
        â”‚  + QuantitÃ©s calculÃ©es
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ BOUTON "Valider & DÃ©duire du Stock"   â”‚
    â”‚ [ROUGE - Action Critique]             â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚  User clique
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ MODAL CONFIRMATION               â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ "ÃŠtes-vous sÃ»r ?"               â”‚
    â”‚ RÃ©sumÃ© produits Ã  dÃ©duire:       â”‚
    â”‚ â€¢ Riz: 50 kg                     â”‚
    â”‚ â€¢ Sauce: 20 L                    â”‚
    â”‚                                  â”‚
    â”‚ [ANNULER] [CONFIRMER]           â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”‚  Click [CONFIRMER]
        â”‚
        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ API REQUEST                                      â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ POST /api/stock/mouvements                       â”‚
    â”‚                                                  â”‚
    â”‚ {                                                â”‚
    â”‚   "type_mouvement": "Consommation_Restauration", â”‚
    â”‚   "date": "2025-04-24",                          â”‚
    â”‚   "reference_restauration": "besoin_id_xyz",     â”‚
    â”‚   "mouvements": [                                â”‚
    â”‚     {                                            â”‚
    â”‚       "produit_id": "prod_riz_123",              â”‚
    â”‚       "quantite": 50,                            â”‚
    â”‚       "unite": "kg",                             â”‚
    â”‚       "motif": "Besoins quotidiens validÃ©s"      â”‚
    â”‚     },                                           â”‚
    â”‚     { ... }                                      â”‚
    â”‚   ]                                              â”‚
    â”‚ }                                                â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â–¼ (Module Stock traite)
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚ VALIDATION STOCK                                 â”‚
    â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
    â”‚ Pour chaque produit:                             â”‚
    â”‚ 1. VÃ©rifier stock actuel >= quantitÃ© demandÃ©e    â”‚
    â”‚ 2. Si OK â†’ CrÃ©er mouvement de dÃ©duction          â”‚
    â”‚ 3. Si KO â†’ Rejeter & retourner erreur            â”‚
    â”‚                                                  â”‚
    â”‚ VÃ©rifications:                                   â”‚
    â”‚ â€¢ Riz: 150 kg dispo â‰¥ 50 kg demandÃ© âœ“ OK         â”‚
    â”‚ â€¢ Sauce: 30 L dispo â‰¥ 20 L demandÃ© âœ“ OK          â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â”œâ”€ SUCCÃˆS â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                           â”‚
        â”‚                           â–¼
        â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚ API RESPONSE (200 OK)       â”‚
        â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                 â”‚ {                           â”‚
        â”‚                 â”‚   "success": true,          â”‚
        â”‚                 â”‚   "mouvements_crees": 2,    â”‚
        â”‚                 â”‚   "total_deduit_fcfa": 5000 â”‚
        â”‚                 â”‚ }                           â”‚
        â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚                           â”‚
        â”‚                           â–¼
        â”‚                 â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
        â”‚                 â”‚ INTERFACE RESTO             â”‚
        â”‚                 â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
        â”‚                 â”‚ âœ“ DÃ©duction confirmÃ©e !     â”‚
        â”‚                 â”‚ Statut â†’ "Stock_DÃ©duit"     â”‚
        â”‚                 â”‚ Stock mis Ã  jour             â”‚
        â”‚                 â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚
        â””â”€ ERREUR â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ API RESPONSE (400/409)      â”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚ {                           â”‚
                          â”‚   "success": false,         â”‚
                          â”‚   "erreur": "Stock insuffisant pour Riz", â”‚
                          â”‚   "produit_id": "prod_riz_123", â”‚
                          â”‚   "stock_dispo": 30,        â”‚
                          â”‚   "quantite_demandee": 50   â”‚
                          â”‚ }                           â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                    â”‚
                                    â–¼
                          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                          â”‚ INTERFACE RESTO             â”‚
                          â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
                          â”‚ âš ï¸ ERREUR - Stock Insuffisantâ”‚
                          â”‚ Riz: 30 kg dispo vs 50 demandÃ© â”‚
                          â”‚                             â”‚
                          â”‚ Options:                    â”‚
                          â”‚ [RÃ©duire qtÃ©] [Changer menu]â”‚
                          â”‚ [Confirmer quand mÃªme]      â”‚
                          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

[HISTORIQUE] Tous les mouvements sont enregistrÃ©s pour audit
```

---

## ğŸ”„ WORKFLOW 3 : Gestion des Pertes/Gaspillage

```
CONSTATATION (Pendant/AprÃ¨s service)
â”‚
â–¼
[AGENT RESTO] AccÃ¨de Ã  "Nouvelle Perte"
â”‚
â”œâ”€ Saisies :
â”‚  â”œâ”€ Produit (search/dropdown)
â”‚  â”œâ”€ QuantitÃ© perdue
â”‚  â”œâ”€ Motif (PÃ©rimÃ© / Gaspillage / DÃ©tÃ©rioration / Autre)
â”‚  â”œâ”€ Date pÃ©remption (si pÃ©rimÃ©)
â”‚  â”œâ”€ Description dÃ©taillÃ©e
â”‚  â””â”€ Photo (optionnel)
â”‚
â–¼
[SYSTÃˆME] Calcule automatiquement :
â”‚  â””â”€ Valeur FCFA = QuantitÃ© Ã— Prix_Unitaire_Stock
â”‚
â–¼
[AGENT RESTO] Click "Enregistrer perte"
â”‚
â–¼
[API CALL] POST /api/stock/mouvements
â”‚  â”œâ”€ Type: "Perte_Gaspillage"
â”‚  â”œâ”€ Produit, quantitÃ©
â”‚  â”œâ”€ Motif
â”‚  â”œâ”€ Valeur FCFA
â”‚  â””â”€ Reference: "perte_id_xyz"
â”‚
â–¼
[MODULE STOCK] Met Ã  jour quantitÃ©s
â”‚  â””â”€ Stock_DÃ©duit = quantitÃ© - perte
â”‚
â–¼
[HISTORIQUE] EnregistrÃ© pour :
   â”œâ”€ Audit/TraÃ§abilitÃ©
   â”œâ”€ Calcul taux gaspillage
   â””â”€ Rapports financiers

RAPPORTS PERTES (Mensuels)
â””â”€ Taux de gaspillage : X% du stock consommÃ©
â””â”€ CoÃ»t total pertes : Y FCFA
â””â”€ Produit le plus gaspillÃ© : [Produit]
```

---

## ğŸ“Š WORKFLOW 4 : GÃ©nÃ©ration de Rapports

```
[UTILISATEUR] AccÃ¨de Ã  "Rapports" dans menu
â”‚
â”œâ”€ SÃ©lectionne :
â”‚  â”œâ”€ Plage de dates
â”‚  â””â”€ Type rapport (Journalier / Mensuel / Annuel)
â”‚
â–¼
[SYSTÃˆME] AgrÃ¨ge donnÃ©es :
â”‚
â”œâ”€ RAPPORT JOURNALIER :
â”‚  â”œâ”€ Par type_service (Petit dÃ©j, DÃ©jeuner, DÃ®ner)
â”‚  â”œâ”€ Tickets payants / gratuits
â”‚  â”œâ”€ Total consommateurs
â”‚  â”œâ”€ Recettes FCFA
â”‚  â”œâ”€ Menu servi
â”‚  â””â”€ Pertes constatÃ©es
â”‚
â”œâ”€ RAPPORT MENSUEL :
â”‚  â”œâ”€ SynthÃ¨se par semaine
â”‚  â”œâ”€ Moyennes quotidiennes
â”‚  â”œâ”€ Ã‰volution vs mois prÃ©cÃ©dent
â”‚  â”œâ”€ Produits consommÃ©s
â”‚  â””â”€ Taux de gaspillage
â”‚
â””â”€ RAPPORT ANNUEL :
   â”œâ”€ SynthÃ¨se par mois
   â”œâ”€ Tendances annuelles
   â”œâ”€ Comparaisons trimestrielles
   â””â”€ Analyse coÃ»ts/recettes

â–¼
[INTERFACE] Affiche :
â”‚  â”œâ”€ Vue tableau (donnÃ©es brutes)
â”‚  â”œâ”€ Graphiques (courbes, histogrammes)
â”‚  â””â”€ Statistiques clÃ©s
â”‚
â–¼
[UTILISATEUR] Clique "Exporter"
â”‚
â”œâ”€ EXPORT PDF :
â”‚  â”œâ”€ Mise en forme professionnelle
â”‚  â”œâ”€ En-tÃªte MESRIT + CROU
â”‚  â”œâ”€ Tableaux + Graphiques
â”‚  â”œâ”€ Signatures (si nÃ©cessaire)
â”‚  â””â”€ Logo institutionnel
â”‚
â””â”€ EXPORT EXCEL :
   â”œâ”€ Feuilles sÃ©parÃ©es (donnÃ©es, graphiques)
   â”œâ”€ Formules Excel (pour analyses ultÃ©rieures)
   â”œâ”€ Mise en forme (couleurs, bordes)
   â””â”€ Pivot tables (optionnel)

â–¼
[TÃ‰LÃ‰CHARGEMENT] Fichier PDF ou XLSX
```

---

## ğŸ“ POINTS D'INTÃ‰GRATION CLÃ‰S

### 1. IntÃ©gration Stock â†’ Restauration (Lecture)
```
Besoin: Afficher stock disponible sur fiche besoins quotidiens

GET /api/stock/produits?type=Alimentaire
â””â”€ RÃ©cupÃ¨re liste produits disponibles

GET /api/stock/produits/{product_id}/disponibilite
â””â”€ Retourne quantitÃ© actuelle + unitÃ© de mesure

FrÃ©quence: Ã€ chaque chargement de page fiche besoins
Caching: 5-10 min pour optimiser performances
```

### 2. Restauration â†’ Stock (DÃ©duction)
```
Action: Valider & DÃ©duire du Stock

POST /api/stock/mouvements
â”œâ”€ Input: Besoin ID + Liste produits
â”œâ”€ Logique: CrÃ©er mouvement de type "Consommation_Restauration"
â””â”€ Output: âœ“ SuccÃ¨s ou âœ— Erreur dÃ©taillÃ©e

Validation avant:
â”œâ”€ Stock suffisant pour tous les produits
â”œâ”€ Pas de dÃ©duction double (idempotence)
â””â”€ Besoin n'est pas dÃ©jÃ  dÃ©duit

Rollback: En cas d'erreur, aucun produit n'est dÃ©duit (transaction)
```

### 3. Restauration â†’ Stock (Pertes)
```
Action: Enregistrer perte/gaspillage

POST /api/stock/mouvements
â”œâ”€ Type: "Perte_Gaspillage"
â”œâ”€ Motif: PÃ©rimÃ© / Gaspillage / DÃ©tÃ©rioration
â”œâ”€ Valeur FCFA: CalculÃ©e localement
â””â”€ Reference: Lien vers perte_id

Synchronisation: Temps rÃ©el (pas de buffering)
Historique: ConservÃ© pour audits ultÃ©rieurs
```

### 4. Restauration â†’ Finances (Recettes)
```
Action: Exporter donnÃ©es financiÃ¨res

POST /api/finances/recettes_restauration
â”œâ”€ Recettes du jour (par type_service)
â”œâ”€ Tickets payants vs gratuits
â”œâ”€ Montant total encaissable
â””â”€ Comparaison vs tickets Ã©mis

FrÃ©quence: Quotidienne (soir aprÃ¨s service)
Format: JSON ou directement dans BD Finances
```

### 5. Restauration â†’ Calendrier AcadÃ©mique
```
Utilisation: Afficher menus inactifs les jours de congÃ©

GET /api/calendrier/periodes-fermeture?annee=2025
â””â”€ Retourne dates de congÃ©s/fermetures

Impact: Menus automatiquement marquÃ©s "Inactifs" ces jours
Interface: Affichage visuel sur calendrier restauration
```

---

## âš ï¸ GESTION DES ERREURS & EDGE CASES

| ScÃ©nario | Comportement | RÃ©solution |
|----------|-------------|-----------|
| **Stock insuffisant** | Alerte avant dÃ©duction | RÃ©duire rationnaires ou changer menu |
| **Produit non trouvÃ© en stock** | API retourne erreur 404 | Option d'ajouter Ã  demande d'achat |
| **DÃ©duction double** | SystÃ¨me dÃ©tecte (mÃªme besoin_id) | Popup "DÃ©jÃ  dÃ©duit" |
| **Perte > stock disponible** | Accepter quand mÃªme (audit) | Logged comme anomalie |
| **Pertes massives** | Alerter manager | Dashboard rouge si > X% |
| **DonnÃ©es synchronisation cassÃ©es** | Logs dÃ©taillÃ©s + notification | Admin : Reconciliator manuel |
| **Tarifs changent en cours jour** | Utiliser tarif du jour | Rapports affichent tarifs appliquÃ©s |
| **Export PDF timeout** | GÃ©nÃ©rer en background | Notification email quand prÃªt |

---

## ğŸ” SÃ‰CURITÃ‰ & PERMISSIONS

### RÃ´les d'AccÃ¨s

| RÃ´le | Lecture | CrÃ©ation | Modification | Validation | Suppression |
|------|---------|----------|-------------|-----------|------------|
| **Admin** | âœ“ Tout | âœ“ Tout | âœ“ Tout | âœ“ Tout | âœ“ Tout |
| **Responsable Resto** | âœ“ Tout | âœ“ Menus/Tickets | âœ“ Menus/Pertes | âœ“ DÃ©ductions | âœ— |
| **Agent Resto** | âœ“ Consultation | âœ“ Tickets/Pertes | âœ“ Ses donnÃ©es | âœ— | âœ— |
| **Comptable** | âœ“ Rapports | âœ— | âœ— | âœ— | âœ— |

### Audit Trail
- Tous les mouvements = log avec (User, Action, Timestamp, Avant/AprÃ¨s)
- Immuable : Pas de suppression directe (soft-delete ou archive)
- Export audit : Pour conformitÃ© MESRIT

---

## ğŸ“¦ DÃ‰PENDANCES EXTERNES

```
Frontend:
â”œâ”€ React + Next.js (assumÃ© existant)
â”œâ”€ React Table / AG-Grid (tableaux)
â”œâ”€ Chart.js / Recharts (graphiques)
â”œâ”€ jsPDF (export PDF)
â””â”€ xlsx (export Excel)

Backend:
â”œâ”€ API REST framework (Django/FastAPI/Express)
â”œâ”€ ORM (Django ORM / SQLAlchemy / Sequelize)
â”œâ”€ PostgreSQL / MySQL (BD)
â”œâ”€ Bull (task queue pour exports longs)
â””â”€ Logger (Winston / Pino)

IntÃ©grations:
â”œâ”€ API Stock (existante)
â”œâ”€ API Finances (existante)
â””â”€ Calendrier AcadÃ©mique (existant)
```

---

## ğŸ¯ CHECKLIST AVANT DÃ‰MARRAGE IMPLÃ‰MENTATION

- [ ] AccÃ¨s aux sources du module Stock confirmÃ©
- [ ] Documentation API Stock disponible & testÃ©e
- [ ] SchÃ©ma BD restauration finalisÃ©
- [ ] Permissions/RÃ´les dÃ©finis
- [ ] Environnement dev setup (DB, API mocks)
- [ ] Tests unitaires framework choisi
- [ ] Design UI approuvÃ© par MESRIT
- [ ] Calendrier acadÃ©mique 2025 intÃ©grÃ©
- [ ] Tarifs restauration confirmÃ©s (150/350/350)
- [ ] Plan de migration donnÃ©es existantes
- [ ] ProcÃ©dure de backup & disaster recovery

---

**PrÃªt Ã  dÃ©marrer l'implÃ©mentation ! ğŸš€**